<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Partner Admin</title>
    <style>
      body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; }
      h1 { color: #333; }
      .back-link { display: inline-block; margin-bottom: 20px; padding: 8px 16px; background: #2196f3; color: white; text-decoration: none; border-radius: 4px; }
      .back-link:hover { background: #1976d2; }
      .info-banner { margin-bottom: 20px; padding: 12px; background: #e3f2fd; border-left: 4px solid #2196f3; }
      ul { list-style: none; padding: 0; }
      ul li { margin: 10px 0; }
      button, a.btn { padding: 8px 16px; margin: 5px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
      button:hover, a.btn:hover { background: #1976d2; }
      button:disabled { background: #ccc; cursor: not-allowed; }
      pre { background: #f5f5f5; padding: 12px; border: 1px solid #ddd; border-radius: 4px; overflow-x: auto; }
      input[type="text"], input[type="number"], select { padding: 6px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
  </head>
  <body>
    <a href="/admin" class="back-link">‚Üê Back to Admin Home</a>
    <h1>Partner Admin</h1>
    <div class="info-banner">
      <strong>Admin Access:</strong> You are logged in as an administrator.
    </div>
    
    <h2>Quick Links</h2>
    <ul>
      <li><a href="/partners/contract">Machine-readable contract</a></li>
      <li><a href="/partners/contract/example">Contract example</a></li>
      <li><a href="/partners/help">Quickstart / Help</a></li>
    </ul>
    
    <h2>Admin Operations</h2>
    <ul>
      <li><a href="/partners/admin/jobs" class="btn">View Jobs</a></li>
      <li><a href="/partners/admin/metrics" class="btn">View Metrics</a></li>
      <li><a href="/partners/admin/audit" class="btn">View Audit Log</a></li>
    </ul>
    
    <h2>Lookup Job</h2>
    <p>
      <label for="job_id">Job ID:</label>
      <input type="number" id="job_id" min="1" placeholder="Enter job ID" />
      <button type="button" id="job_lookup">View Job</button>
    </p>
    <pre id="job_resp" style="display:none;"></pre>
    
    <script>
      const jobBtn = document.getElementById('job_lookup');
      const jobResp = document.getElementById('job_resp');
      jobBtn.addEventListener('click', async function () {
        const id = document.getElementById('job_id').value;
        if (!id) { alert('Enter a job id'); return; }
        jobResp.style.display = 'none';
        try {
          const r = await fetch(`/partners/jobs/${id}`, { credentials: 'same-origin', headers: {'X-Requested-With':'XMLHttpRequest'} });
          const txt = await r.text();
          try { 
            const json = JSON.parse(txt); 
            jobResp.textContent = JSON.stringify(json, null, 2); 
          } catch(e) { 
            jobResp.textContent = txt; 
          }
          jobResp.style.display = 'block';
        } catch (err) {
          jobResp.textContent = 'Request failed: ' + err;
          jobResp.style.display = 'block';
        }
      });
    </script>
    
    <h2>Onboard Partner</h2>
    <p>
      <label for="on_name">Partner name:</label>
      <input type="text" id="on_name" placeholder="Acme Partner" />
      <label for="on_format">Format:</label>
      <select id="on_format">
        <option value="json">json</option>
        <option value="csv">csv</option>
      </select>
      <label for="on_desc">Description:</label>
      <input type="text" id="on_desc" placeholder="description" />
      <button type="button" id="on_btn">Create Partner</button>
    </p>
    <pre id="on_resp" style="display:none;"></pre>
    
    <script>
      const onBtn = document.getElementById('on_btn');
      const onResp = document.getElementById('on_resp');
      onBtn.addEventListener('click', async function () {
        const name = document.getElementById('on_name').value;
        const format = document.getElementById('on_format').value;
        const desc = document.getElementById('on_desc').value;
        if (!name) { alert('Enter partner name'); return; }
        onResp.style.display = 'none';
        try {
          const r = await fetch('/partners/onboard_form', {
            method: 'POST', 
            headers: {'Content-Type': 'application/json'},
            credentials: 'same-origin',
            body: JSON.stringify({name: name, format: format, description: desc})
          });
          const txt = await r.text();
          try { 
            const json = JSON.parse(txt); 
            onResp.textContent = JSON.stringify(json, null, 2); 
          } catch(e) { 
            onResp.textContent = txt; 
          }
          onResp.style.display = 'block';
        } catch (err) {
          onResp.textContent = 'Request failed: ' + err;
          onResp.style.display = 'block';
        }
      });
    </script>
  </body>
</html>